(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19bcd28c"],{"70ce":function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var l=a("a4ee"),i=(a("c120"),a("e92d"),a("cea0"),a("59b2")),s=a("d386"),r=(a("e041"),a("8eed"),a("f402"),a("fc29")),n=a("22f4"),o=a("9096"),c=a("2258");const d={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let y=class extends(Object(o["b"])(r["a"])){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(e=>e.toExportImageJSON());return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&Object(c["a"])(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",e=>this.notifyChange(d[e.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(e=>e.id).join(","):"show:-1":null}get layerDefs(){const e=this.visibleSublayers.filter(e=>null!=e.definitionExpression);return e.length?JSON.stringify(e.reduce((e,t)=>(e[t.id]=t.definitionExpression,e),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,a=t=>{const l=this.scale,i=0===l,s=0===t.minScale||l<=t.minScale,r=0===t.maxScale||l>=t.maxScale;t.visible&&(i||s&&r)&&(t.sublayers?t.sublayers.forEach(a):e.unshift(t))};t&&t.forEach(a);const l=this._get("visibleSublayers");return!l||l.length!==e.length||l.some((t,a)=>e[a]!==t)?e:l}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};Object(l["a"])([Object(i["b"])({readOnly:!0})],y.prototype,"dynamicLayers",null),Object(l["a"])([Object(i["b"])({readOnly:!0})],y.prototype,"hasDynamicLayers",null),Object(l["a"])([Object(i["b"])()],y.prototype,"layer",null),Object(l["a"])([Object(i["b"])({readOnly:!0})],y.prototype,"layers",null),Object(l["a"])([Object(i["b"])({readOnly:!0})],y.prototype,"layerDefs",null),Object(l["a"])([Object(i["b"])({type:Number})],y.prototype,"scale",void 0),Object(l["a"])([Object(i["b"])(n["a"])],y.prototype,"timeExtent",void 0),Object(l["a"])([Object(i["b"])({readOnly:!0})],y.prototype,"version",null),Object(l["a"])([Object(i["b"])({readOnly:!0})],y.prototype,"visibleSublayers",null),y=Object(l["a"])([Object(s["a"])("esri.layers.mixins.ExportImageParameters")],y)},"8ab7":function(e,t,a){"use strict";a.r(t);var l=a("a4ee"),i=(a("c120"),a("e92d")),s=a("59b2"),r=a("4adc"),n=a("1a3e"),o=a("d386"),c=a("e041"),d=(a("8eed"),a("f402"),a("af40")),y=a("3795"),u=a("702a"),h=a("755e"),b=a("26fd"),p=a("121a"),m=(a("cea0"),a("fc29")),f=a("2c4f"),g=a("20351"),v=(a("1b8f"),a("b2b2")),_=a("fa8a"),L=a("f4cc"),w=a("c1da"),O=a("9ef0"),j=a("a915"),S=a("f7be"),I=a("2eab"),C=a("0d76"),A=a("4dc9"),E=a("1fd7"),R=a("bc29"),x=a("d445"),z=a("ac8e"),V=a("f976"),k=a("70ce"),T=a("bef8");a("ce50"),a("cf49");function F(e){return Object(v["j"])(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type}var M=a("c3fc");const B=(e,t)=>{const a=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!=t&&t.levels?t.levels[a]:null};function N(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const a=e.visualVariables.find(e=>"size"===e.type),l=B(t,a);return l?new M["a"]({field:a.field,minSize:l[2].size,minDataValue:l[2].value,maxSize:l[3].size,maxDataValue:l[3].value}):null}var D=a("4653"),P=a("21e2");const q=/^-?(\d+)(\.(\d+))?$/i;function H(e,t){return e-t}function $(e,t){let a,l;return a=Number(e.toFixed(t)),a<e?l=a+1/10**t:(l=a,a-=1/10**t),a=Number(a.toFixed(t)),l=Number(l.toFixed(t)),[a,l]}function U(e,t,a,l,i){const s=G(e,t,a,l),r=null==s.previous||s.previous<=i,n=null==s.next||s.next<=i;return r&&n||s.previous+s.next<=2*i}function W(e){const t=String(e),a=t.match(q);if(a&&a[1])return{integer:a[1].split("").length,fractional:a[3]?a[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){const e=t.split("e"),a=e[0],l=e[1];if(a&&l){const e=Number(a);let t=Number(l);const i=t>0;i||(t=Math.abs(t));const s=W(e);return i?(s.integer+=t,t>s.fractional?s.fractional=0:s.fractional-=t):(s.fractional+=t,t>s.integer?s.integer=1:s.integer-=t),s}}return{integer:0,fractional:0}}function G(e,t,a,l){const i={previous:null,next:null};if(null!=a){const l=e-a,s=t-a-l;i.previous=Math.floor(Math.abs(100*s/l))}if(null!=l){const a=l-e,s=l-t-a;i.next=Math.floor(Math.abs(100*s/a))}return i}function J(e,t={}){const a=e.slice(0),{tolerance:l=2,strictBounds:i=!1,indexes:s=a.map((e,t)=>t)}=t;s.sort(H);for(let r=0;r<s.length;r++){const e=s[r],t=a[e],n=0===e?null:a[e-1],o=e===a.length-1?null:a[e+1],c=W(t).fractional;if(c){let s,d=0,y=!1;for(;d<=c&&!y;){const e=$(t,d);s=i&&0===r?e[1]:e[0],y=U(t,s,n,o,l),d++}y&&(a[e]=s)}}return a}const Q={maximumFractionDigits:20};function K(e){return Object(P["b"])(e,Q)}const X="<",Y=">",Z=Object(D["a"])("short-date");function ee(e,t,a,l){let i="";0===t?i=X+" ":t===a&&(i=Y+" ");let s=null;return s=l?Object(D["b"])(e,Z):K(e),i+s}const te=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="],ae=new O["a"]([64,64,64]);function le(e,t){const a=[],l=e.length-1;return 5===e.length?a.push(0,2,4):a.push(0,l),e.map((e,i)=>a.indexOf(i)>-1?ee(e,i,l,t):null)}async function ie(e,t,l){let i=!1,s=[],r=[];if(e.stops){const t=e.stops;s=t.map(e=>e.value),i=t.some(e=>!!e.label),i&&(r=t.map(e=>e.label))}const n=s[0],o=s[s.length-1];if(null==n&&null==o)return null;const c=i?null:le(s,l);return(await Promise.all(s.map(async(l,s)=>({value:l,color:"opacity"===e.type?await se(l,e,t):(await Promise.resolve().then(a.bind(null,"d297"))).getColor(e,l),label:i?r[s]:c[s]})))).reverse()}async function se(e,t,l=ae){const i=new O["a"](l),s=(await Promise.resolve().then(a.bind(null,"d297"))).getOpacity(t,e);return null!=s&&(i.a=s),i}function re(e){let t=!1,a=[],l=[];a=e.map(e=>e.value),t=e.some(e=>!!e.label),t&&(l=e.map(e=>e.label));const i=a[0],s=a[a.length-1];if(null==i&&null==s)return null;const r=t?null:le(a,!1);return a.map((a,i)=>({value:a,color:ne(a,e),label:t?l[i]:r[i]})).reverse()}function ne(e,t){const{startIndex:a,endIndex:l,weight:i}=oe(e,t);if(a===l)return t[a].color;const s=O["a"].blendColors(t[a].color,t[l].color,i);return new O["a"](s)}function oe(e,t){let a=0,l=t.length-1;return t.some((t,i)=>e<t.value?(l=i,!0):(a=i,!1)),{startIndex:a,endIndex:l,weight:(e-t[a].value)/(t[l].value-t[a].value)}}function ce(e,t){let a=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((function(l,i){0===i?a.push({value:t.max,color:new O["a"](l.toColor),label:"high"}):a.push({value:null,color:new O["a"](l.toColor),label:""}),i===e.colorRamps.length-1?a.push({value:t.min,color:new O["a"](l.fromColor),label:"low"}):a.push({value:null,color:new O["a"](l.fromColor),label:""})}));else{let l,i;e&&"algorithmic"===e.type?(l=e.fromColor,i=e.toColor):(l=[0,0,0,1],i=[255,255,255,1]),a=[{value:t.max,color:new O["a"](i),label:"high"},{value:t.min,color:new O["a"](l),label:"low"}]}return a}var de=a("daeb");function ye(e){let t=e.colorStops,a=t.length-1;if(t&&t[0]){const e=t[a];e&&1!==e.ratio&&(t=t.slice(0),t.push(new de["a"]({ratio:1,color:e.color})),a++)}return t.map((e,t)=>{let l="";return 0===t?l="low":t===a&&(l="high"),{color:e.color,label:l,ratio:e.ratio}}).reverse()}a("7ffa");var ue=a("cdd0"),he=a("720f");const be={HH:315,HL:45,LL:135,LH:225},pe={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function me(e){if(!e)return;const{type:t}=e;if(t.indexOf("3d")>-1)return Object(he["getSymbolLayerFill"])(e.symbolLayers.getItemAt(0));if("simple-line"===t){const t=Object(ue["d"])(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=Object(ue["d"])(e);return t&&t.color}return Object(ue["b"])(e)}function fe(e,t){const a=t.HH.label,l=t.LL.label,i=t.HL.label,s=t.LH.label;switch(e){case"HH":return{top:a,bottom:l,left:i,right:s};case"HL":return{top:i,bottom:s,left:l,right:a};case"LL":return{top:l,bottom:a,left:s,right:i};case"LH":return{top:s,bottom:i,left:a,right:l};default:return{top:a,bottom:l,left:i,right:s}}}function ge(e){const{focus:t,infos:a,numClasses:l}=e,i=pe[l],s={};a.forEach(e=>{s[e.value]={label:e.label,fill:me(e.symbol)}});const r=[];for(let n=0;n<l;n++){const e=[];for(let t=0;t<l;t++){const a=s[i[n][t]];e.push(a.fill)}r.push(e)}return{type:"relationship-ramp",numClasses:l,focus:t,colors:r,labels:fe(t,s),rotation:ve(t)}}function ve(e){let t=be[e];return e&&null==t&&(t=be.HH),t||0}const _e=30,Le=12,we=[255,255,255],Oe=[200,200,200],je=[128,128,128],Se=20,Ie=5;function Ce(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}function Ae(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}function Ee(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}function Re(e){return"esri.symbols.TextSymbol"===e.declaredClass}function xe(e,t){const a=e.length-1;return e.map((e,l)=>ee(e,l,a,t))}async function ze(e,t,a,l,i,s){var r,n;const o=t.legendOptions,c=o&&o.customValues,d=Te(e,a),y=!!d,u=!!c,h=null!=t.minSize&&null!=t.maxSize,b=t.stops&&t.stops.length>1,p=!!t.target;if(!y||!u&&!(h||b&&!p))return;const m=Object(z["h"])(d);let f=null,g=null,v=null;g=m&&!b?J([t.minDataValue,t.maxDataValue]):c||await Ne(t,d,l,i);const _=null==e?void 0:e.authoringInfo,L="univariate-color-size"===(null==_?void 0:_.type),w=L&&"above-and-below"===(null==_?void 0:_.univariateTheme);if(!g&&b&&(g=t.stops.map(e=>e.value),f=t.stops.some(e=>!!e.label),f&&(v=t.stops.map(e=>e.label))),m&&(null==(r=g)?void 0:r.length)>2&&!w&&(g=[g[0],g[g.length-1]]),!g)return null;L&&5!==(null==(n=g)?void 0:n.length)&&(g=De({minSize:g[0],maxSize:g[g.length-1]}));const O=m?Ve(e,g):null,j=Object(z["g"])(d),S=f?null:xe(g,s);return(await Promise.all(g.map(async(a,s)=>{const r=m?O[s]:await He(t,d,a,l,i);return{value:a,symbol:$e(w&&"class-breaks"===e.type?ke(e,s):d,r),label:f?v[s]:S[s],size:r,outlineSize:j}}))).reverse()}function Ve(e,t){const a=null==e?void 0:e.authoringInfo,l="univariate-color-size"===(null==a?void 0:a.type);let i=[Le,_e];if(l){const e=t[0],a=t[t.length-1],l=Le,s=_e;i=t.map(t=>l+(t-e)/(a-e)*(s-l))}return l&&"below"===(null==a?void 0:a.univariateTheme)&&i.reverse(),i}function ke(e,t){const a=e.classBreakInfos,l=a.length,i=l<2||!(t>=2)?a[0].symbol.clone():a[l-1].symbol.clone();return e.visualVariables.some(e=>"color"===e.type)&&(i.type.indexOf("3d")>-1?Me(i):Be(i)),i}function Te(e,t){let a=null,l=null;if("simple"===e.type)a=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;a=t&&t[0]&&t[0].symbol,l=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;a=t&&t[0]&&t[0].symbol,l=t.length>1}return!a||Fe(a)?null:(a=a.clone(),(t||l)&&(a.type.indexOf("3d")>-1?Me(a):Be(a)),a)}function Fe(e){return!!e&&(Object(E["c"])(e)?!!e.symbolLayers&&e.symbolLayers.some(e=>e&&"fill"===e.type):-1!==e.type.indexOf("fill"))}function Me(e){"line-3d"===e.type?e.symbolLayers.forEach(e=>{e.material={color:je}}):e.symbolLayers.forEach(e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:Oe}:(e.material={color:we},e.outline={color:je,size:1.5})})}function Be(e){"cim"===e.type?Object(x["a"])(e,new O["a"](Oe)):-1!==e.type.indexOf("line")?e.color=je:(e.color=we,"simple-marker"===e.type&&(e.outline={color:je,width:1.5}))}async function Ne(e,t,l,i){const s=(await Promise.resolve().then(a.bind(null,"d297"))).getSizeRangeAtScale(e,l,i),r=s&&De(s);if(!s&&!r)return;let n=r.map(t=>Pe(t,e,s));n=J(n);for(let a=1;a<n.length-1;a++){const s=await qe(e,t,n[a],n[a-1],l,i);s&&(n[a]=s[0],r[a]=s[1])}return n}function De(e){const t=e.minSize,a=e.maxSize,l=Ie,i=(a-t)/(l-1),s=[];for(let r=0;r<l;r++)s.push(t+i*r);return s}function Pe(e,t,a){const l=a.minSize,i=a.maxSize,s=t.minDataValue,r=t.maxDataValue;let n=null;return n=e<=l?s:e>=i?r:(e-l)/(i-l)*(r-s)+s,n}async function qe(e,t,a,l,i,s){const r=await He(e,t,a,i,s),n=await He(e,t,l,i,s),o=W(a),c=o.fractional,d=Se;let y=o.integer,u=null,h=null;a>0&&a<1&&(u=10**c,y=W(a*=u).integer);for(let b=y-1;b>=0;b--){const l=10**b;let o=Math.floor(a/l)*l,c=Math.ceil(a/l)*l;null!=u&&(o/=u,c/=u);let y=(o+c)/2;[,y]=J([o,y,c],{indexes:[1]});const p=await He(e,t,o,i,s),m=await He(e,t,c,i,s),f=await He(e,t,y,i,s),g=G(r,p,n,null),v=G(r,m,n,null),_=G(r,f,n,null);let L=g.previous<=d,w=v.previous<=d;if(L&&w&&(g.previous<=v.previous?(L=!0,w=!1):(w=!0,L=!1)),L?h=[o,p]:w?h=[c,m]:_.previous<=d&&(h=[y,f]),h)break}return h}async function He(e,t,l,i,s){const{getSize:r}=await Promise.resolve().then(a.bind(null,"d297"));return r(e,l,{scale:i,view:s,shape:"simple-marker"===t.type?t.style:null})}function $e(e,t){const a=e.clone();if(Object(E["c"])(a))Object(z["h"])(a)||a.symbolLayers.forEach(e=>{"fill"!==e.type&&(e.size=t)});else if(Ce(a))a.size=t;else if(Ae(a)){const e=a.width,l=a.height;a.height=t,a.width=t*(e/l)}else Ee(a)?a.width=t:Re(a)&&a.font&&(a.font.size=t);return a}const Ue=i["a"].getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),We="https://utility.arcgis.com/sharing/tools/legend",Ge="esri.layers.ImageryLayer",Je="esri.layers.ImageryTileLayer",Qe="esri.layers.WCSLayer",Ke=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Xe=new _["a"]({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Ye={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Ze=new A["a"]({size:6,outline:{color:[128,128,128,.5],width:.5}}),et=new C["a"]({style:"solid"});function tt(e){return"vector-field"===e.type}function at(e){return"raster-colormap"===e.type}function lt(e){return"raster-stretch"===e.type}function it(e){return"raster-shaded-relief"===e.type}function st(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function rt(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function nt(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function ot(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function ct(e){return yt(e)||ut(e)||ht(e)||dt(e)}function dt(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}function yt(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function ut(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function ht(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function bt(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function pt(e,t){return st(e)||rt(e)||nt(e)||ot(e)||bt(e)?"2d"===t.type||F(e):lt(e)||at(e)||it(e)||yt(e)||ut(e)||ht(e)||tt(e)}function mt(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function ft(e){return"esri.layers.WMSLayer"===e.declaredClass}function gt(e){return"esri.layers.WMTSLayer"===e.declaredClass}function vt(e){return"esri.layers.MapImageLayer"===e.declaredClass}function _t(e){return"esri.layers.TileLayer"===e.declaredClass}function Lt(e){return"esri.layers.FeatureLayer"===e.declaredClass}function wt(e){return e.declaredClass===Ge}function Ot(e){return e.declaredClass===Je}function jt(e){return e.declaredClass===Qe}function St(e){return"stretch-ramp"===e.type}function It(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)}function Ct(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}const At=new A["a"]({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Et={},Rt=class extends m["a"]{constructor(e){super(e),this._handles=new d["a"],this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new f["a"],this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([Object(y["b"])(this,"children","change",t=>{const{added:a,removed:l}=t,i=this._handles;a.map(t=>{const a="activeLayerInfo-ready-watcher-"+t.layer.uid;i.add(Object(y["a"])(t,"ready",e),a)}),l.forEach(e=>i.remove(e.layer.uid)),e()})]),this.keepCacheOnDestroy||(Et={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Et=null)}get opacity(){var e;const t=this.layer.opacity,a=null==(e=this.parent)?void 0:e.opacity,l=this.layer.parent,i=l&&"uid"in l?this._getParentLayerOpacity(l):null;return null!=a?a*t:null!=i?i*t:t}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("featureReduction"in e&&e.featureReduction&&"cluster"===e.featureReduction.type)return!0;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return!0;const t=e.get("renderer.valueExpression");if(Ke.test(t))return!0;const a=e.get("renderer.visualVariables");if(a)return a.some(e=>this._isScaleDrivenSizeVariable(e))}return this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){const t=e.map(e=>{if(Lt(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,a=t&&t.drawingInfo,l=a&&Object(V["a"])(a.renderer),i=Xe.read(t.geometryType);return l?this._getRendererLegendElements(l,{title:e.name,geometryType:i}):(Ue.warn("drawingInfo not available!"),null)}return null});try{const e=[];await Object(L["j"])(t).then(t=>{t.forEach(({value:t})=>t&&e.push(...t))}),this.legendElements=e,this.notifyChange("ready")}catch(a){Ue.warn("error while building legend for layer!",a)}}async buildLegendElementsForRenderer(e){try{const t=await this._getRendererLegendElements(e);this.legendElements=t,this.notifyChange("ready")}catch(t){Ue.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;gt(e)?this._constructLegendElementsForWMTSlayer():ft(e)?await this._constructLegendElementsForWMSSublayers():mt(e)?await this._constructLegendElementsForBuildingSceneLayer():vt(e)||_t(e)||mt(e)?await this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),await this._getLegendLayers(e.uid+"-default").then(async t=>{this.legendElements=[],this.notifyChange("ready");const a=t.map(async t=>{if(wt(e)||Ot(e)){const t=e.watch(["renderingRule","bandIds"],()=>Object(L["i"])(async()=>{Et.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()})());this._handles.add(t,"imageryLayers-watcher")}const a=this._generateSymbolTableElementForLegendLayer(t);a&&a.infos.length&&(wt(e)&&(a.title=e.title),this.legendElements.push(a)),this.notifyChange("ready")});await Object(L["j"])(a)}).catch(e=>{Ue.warn("Request to server for legend has failed!",e)}))}_getParentLayerOpacity(e){let t=1;const a=e.parent;return a&&"uid"in a&&(t=this._getParentLayerOpacity(a)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some(e=>e.ready)}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,a=t.minSize,l=t.maxSize;return"object"==typeof a&&a?this._isScaleDrivenSizeVariable(a):"object"==typeof l&&l?this._isScaleDrivenSizeVariable(l):!!t.expression||Ke.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(e=>this._isLayerScaleDriven(e));const t=e.parent;if(!1===e.loaded&&t&&vt(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const a of t.sourceJSON.layers)if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0;return!1}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(Object(y["d"])(this.layer,"activeLayer",()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some(a=>e.styleId===a.id&&(t=a.legendUrl,!0)),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add(Object(y["d"])(this.layer,"sublayers",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const a=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const l=e.toArray();for(const i of l){const e=i.watch(["title","visible","legendEnabled"],()=>this._constructLegendElementsForWMSSublayers());if(this._handles.add(e,"wms-sublayers-watcher"),i.visible&&i.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(i,t);e&&e.infos.length&&a.unshift(e)}}return a}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const a=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(e=>e);return{type:"symbol-table",title:e.title,infos:a}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var a;let l=e.legendUrl;if(!l)return;const i={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(l+="?"+Object(c["D"])(t));let s=null;const r=null==(a=e.layer)?void 0:a.opacity;try{s=(await Object(I["default"])(l,{responseType:"image"})).data,s&&(s.style.opacity=r)}catch{}return i.infos.push({src:l,preview:s,opacity:r}),i}_getLegendLayers(e,t){const a=Et&&Et[e];return a?Promise.resolve(a):this._legendRequest(t).then(t=>{const a=t.layers;return Et[e]=a,a})}_legendRequest(e){const t=this.layer;let a={f:"json",dynamicLayers:e};if(wt(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(a.renderingRule=JSON.stringify(e.toJSON())),t.bandIds&&(a.bandIds=t.bandIds.join()),t.raster||t.viewId){const{raster:e,viewId:l}=t;a={raster:e,viewId:l,...a}}}let l=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=l.indexOf("?");e>-1?l=l.substring(0,e)+"/legend"+l.substring(e):l+="/legend"}else{const e=l.toLowerCase().indexOf("/rest/"),t=l.substring(0,e)+l.substring(e+5,l.length);l=We+"?soapUrl="+encodeURI(t)+"&returnbytes=true"}return Object(I["default"])(l,{query:a}).then(e=>e.data)}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(Object(y["d"])(e,"sublayers",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Ue.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let a=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const l=e.toArray();for(const i of l){const e=i.watch(["renderer","opacity","title","visible"],()=>this._constructLegendElementsForBuildingSceneLayer());if(this._handles.add(e,"sublayers-watcher"),i.visible){const e=i&&null!=i.opacity?i.opacity:null,l=null!=e?e*t:t;if("building-group"===i.type){const e={type:"symbol-table",title:i.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(i.sublayers,l);e.infos.push(...t),a=[e,...a]}else i.renderer&&(a=[...await this._getRendererLegendElements(i.renderer,{title:i.title,opacity:l,sublayer:i}),...a])}}return a.filter(e=>!!e&&(!("infos"in e)||e.infos.length>0))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(Object(y["d"])(e,"sublayers",()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Ue.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,a){const l=this.layer;let i=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let s=e.toArray();!a&&this.sublayerIds&&this.sublayerIds.length&&(s=this.sublayerIds.map(e=>l.findSublayerById(e)).filter(Boolean));for(const r of s){const e=r.watch("renderer, opacity, title, visible, legendEnabled",()=>this._constructLegendElementsForSublayers());if(this._handles.add(e,"sublayers-watcher"),r.visible&&r.legendEnabled&&(!this.respectLayerVisibility||this._isSublayerInScale(r))){const e=r&&null!=r.opacity?r.opacity:null,l=null!=e?e*t:t;if(r.renderer&&!r.sublayers&&r.originIdOf("renderer")>2)await r.load(),i=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:l,sublayer:r}),...i];else{const e=await this._generateSymbolTableElementForSublayer(r,l,a);e&&i.unshift(e)}}}return i.filter(e=>!!e&&(!("infos"in e)||e.infos.length>0))}async _generateSymbolTableElementForSublayer(e,t,a){if(!a){a=new Map;const t=new k["a"]({layer:this.layer}),l=t.hasDynamicLayers?t.dynamicLayers:null;t.destroy();const i=l||`${this.layer.uid}-${e.id}-default`;(await this._getLegendLayers(i,l)).forEach(e=>a.set(e.layerId,e))}const l=a.get(e.id);if(!l&&e.sublayers){const l=await this._generateLegendElementsForSublayers(e.sublayers,t,a);return{type:"symbol-table",title:e.title,infos:l}}return this._generateSymbolTableElementForLegendLayer(l,e,t)}_generateSymbolTableElementForLegendLayer(e,t,a){var l;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const i=null==t?void 0:t.renderer;let s=(null==t?void 0:t.title)||e.layerName;if(i&&(!t||(null==t?void 0:t.originIdOf("renderer"))>2)){const e=(null==t?void 0:t.title)||this._getRendererTitle(i,t);e&&(s&&"string"!=typeof e&&"title"in e&&(e.title=s),s=e)}const r={type:"symbol-table",title:s,legendType:e.legendType?e.legendType:null,infos:[]},n=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null==(l=e.legendGroups)?void 0:l.length)>0?e.legendGroups.forEach(t=>{var l;const i={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(n.filter(e=>e.groupId===t.id),e.layerId,a)};(null==(l=i.infos)?void 0:l.length)>0&&r.infos.push(i)}):r.infos=this._generateSymbolTableElementInfosForLegendLayer(n,e.layerId,a),r.infos.length>0?r:null}_generateSymbolTableElementInfosForLegendLayer(e,t,a){return e.map(e=>{let l=e.url;if(e.imageData&&e.imageData.length>0)l="data:image/png;base64,"+e.imageData;else{if(0===l.indexOf("http"))return null;l=Object(S["a"])(`${this.layer.url}/${t}/images/${l}`)}return{label:e.label,src:l,opacity:null==a?this.opacity:a,width:e.width,height:e.height}}).filter(e=>!!e)}_isSublayerInScale(e){const t=e.minScale||0,a=e.maxScale||0;return!(t>0&&t<this.scale||a>this.scale)}_isLegendLayerInScale(e,t){const a=t||this.layer;let l=null,i=null,s=!0;return!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0===e.minScale&&a.tileInfo&&(l=a.tileInfo.lods[0].scale),0===e.maxScale&&a.tileInfo&&(i=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(l=Math.min(a.minScale,e.minScale)||a.minScale||e.minScale,i=Math.max(a.maxScale,e.maxScale)),(l>0&&l<this.scale||i>this.scale)&&(s=!1),s}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const a=t.renderer,l=e.some(e=>e.values);let i=null,s=null;return l&&e.some((e,t)=>(e.values||(i=t,s=e,s.label||(s.label="others")),null!=s)),a?"unique-value"===a.type?s&&(e.splice(i,1),e.push(s)):"class-breaks"===a.type&&(s&&e.splice(i,1),e.reverse(),s&&e.push(s)):s&&(e.splice(i,1),e.push(s)),e}async _getRendererLegendElements(e,t={}){return pt(e,this.view)?ct(e)?this._constructPointCloudRendererLegendElements(e,t):bt(e)?this._constructDotDensityRendererLegendElements(e):this._constructRendererLegendElements(e,t):(Ue.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const a=t.title,l=[];let i=null,s=null;if(yt(e))i={type:"symbol-table",title:a||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(e=>{i.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(Ze,e.color)})});else if(ut(e)){const t=e.stops;let l=null;if(t.length&&(1===t.length&&(l=t[0].color),!l)){const e=t[0].value,a=t[t.length-1].value;null!=e&&null!=a&&(l=ne(e+(a-e)/2,t))}i={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Ze,l||Ze.color)}]};const r=re(e.stops);s={type:"color-ramp",title:a||this._getPointCloudRendererTitle(e),infos:r,preview:Object(T["b"])(r.map(e=>e.color))}}else ht(e)&&(i={type:"symbol-table",title:a||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach(e=>{i.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(Ze,e.color)})}));i&&i.infos.length&&l.push(i),s&&s.infos.length&&l.push(s);const r=l.reduce((e,t)=>e.concat(t.infos),[]).filter(e=>!!e.symbol).map(t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return Object(L["j"])(r).then(()=>l)}_getElementInfoForDotDensity(e,t){const{backgroundColor:a,outline:l,dotSize:i}=e,s=i+"-"+t+"-"+a+"-"+(l&&JSON.stringify(l.toJSON())),r=this._dotDensityUrlCache,n=r.has(s)?r.get(s):Object(T["c"])(e,t);return r.set(s,n),{opacity:1,src:n.src,preview:n,width:n.width,height:n.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),a=e.legendOptions&&e.legendOptions.unit,l={type:"symbol-table",title:{value:t&&Math.round(t),unit:a||""},infos:[]};return e.attributes.forEach(t=>{const a=this._getElementInfoForDotDensity(e,t.color);a.label=t.label||t.valueExpressionTitle||t.field,l.infos.push(a)}),Promise.resolve([l])}async _constructRendererLegendElements(e,t={}){const{title:a,sublayer:l}=t,i=l||this.layer;let s=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const r=await this._getVisualVariableLegendElements(s,i)||[],n={type:"symbol-table",title:a||this._getRendererTitle(s,i),infos:[]};let o=null,c=!1;const d=new Set;if(It(s)){let e=a;const t=Ct(s)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",l=r.findIndex(e=>"color-ramp"===e.type),i=r.splice(l,1)[0],n=r.findIndex(e=>"size-ramp"===e.type),o=r.splice(n,1)[0],c=[];i&&(e=i.title,c.push(i)),o&&(e=o.title,c.push(o)),c.length>0&&r.push({type:t,title:e,infos:c})}else if(ot(s)){const e=ye(s);r.push({type:"heatmap-ramp",title:a,infos:e,preview:Object(T["b"])(e.map(e=>e.color))})}else if(nt(s)){const e=s&&s.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:a,field1:l,field2:o}=e;if(a&&l&&o){const e=[l,o];let c=ve(t)||0;for(const t of e){const{field:e,normalizationField:a,label:l}=t,s=l||{field:this._getFieldAlias(e,i),normField:a&&this._getFieldAlias(a,i)},r=At.clone();r.angle=c,n.infos.push({label:s,symbol:r}),d.add(r),c+=90}const y=ge({focus:t,numClasses:a,infos:s.uniqueValueInfos});r.unshift(y)}}else{const e=s.field;s.uniqueValueInfos.forEach(t=>{t.symbol&&n.infos.push({label:t.label||this._getDomainName(e,t.value,i)||t.value,value:t.value,symbol:t.symbol})})}s.defaultSymbol&&(n.infos.push({label:s.defaultLabel||"others",symbol:s.defaultSymbol}),c=!0)}else if(rt(s))o=this._isUnclassedRenderer(s),(!o||!this._hasSizeRamp)&&(s.classBreakInfos.forEach(e=>{e.symbol&&n.infos.unshift({label:e.label||(o?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})}),o&&(n.title=null),this._updateInfosforClassedSizeRenderer(s,n.infos)),s.defaultSymbol&&!o&&(n.infos.push({label:s.defaultLabel||"others",symbol:s.defaultSymbol}),c=!0);else if(lt(s)){var y,u;if(Ot(this.layer)&&"Map"===(null==(y=this.layer)||null==(u=y.raster)?void 0:u.tileType))this._getServerSideLegend();else if(Ot(this.layer)||jt(this.layer)){const e=this._constructTileImageryStretchRendererElements(s);St(e)?r.push(e):n.infos=e}else{const e=this.layer;let t,a;var h,b;s.statistics&&s.statistics.length?(t=null!=s.statistics[0].min?s.statistics[0].min:s.statistics[0][0],a=null!=s.statistics[0].max?s.statistics[0].max:s.statistics[0][1]):(t=null==(h=s)?void 0:h.outputMin,a=null==(b=s)?void 0:b.outputMax);let l=[];const i=Object(v["q"])(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),o=i.keyProperties.BandProperties;1===i.bandCount?(t=null!=t?t:i.statistics&&i.statistics[0].min,a=null!=a?a:i.statistics&&i.statistics[0].max,t||a?r.push(this._getStretchLegendElements(s,{min:t,max:a})):this._getServerSideLegend()):e.bandIds&&1===e.bandIds.length?(t=null!=t?t:i.statistics&&i.statistics[e.bandIds[0]].min,a=null!=a?a:i.statistics&&i.statistics[e.bandIds[0]].max,t||a?r.push(this._getStretchLegendElements(s,{min:t,max:a})):this._getServerSideLegend()):i.bandCount>=3?o&&o.length>=i.bandCount?e.bandIds&&3===e.bandIds.length?(l=e.bandIds.map(e=>o[e].BandName),n.infos=this._createSymbolTableElementMultiBand(l)):"lerc"===e.format?(l=[0,1,2].map(e=>o[e].BandName),n.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():"lerc"===e.format?(l=["band1","band2","band3"],n.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():this._getServerSideLegend()}}else if(at(s))s.colormapInfos.forEach(e=>{n.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(et,e.color)})});else if(st(s)){let e=s.symbol;switch(t.geometryType){case"point":e="pointSymbol"in i&&i.pointSymbol;break;case"polyline":e="lineSymbol"in i&&i.lineSymbol;break;case"polygon":e="polygonSymbol"in i&&i.polygonSymbol}s.symbol&&!this._hasSizeRamp&&n.infos.push({label:s.label,symbol:e})}else if(tt(s)){s.outputUnit&&(this.title="("+s.toJSON().outputUnit+")"),n.title=s.attributeField;const e=s.getClassBreakInfos();null!=e&&e.length?e.forEach(e=>{n.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})}):n.infos.push({label:s.attributeField,symbol:s.getDefaultSymbol()})}else it(s)&&r.push(this._getStretchLegendElements(s,{min:0,max:255}));const p=s.defaultSymbol;!p||c||st(s)||o&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||r.push({type:"symbol-table",infos:[{label:s.defaultLabel||"others",symbol:p}]}),n.infos.length&&r.unshift(n);const m=null==t.opacity?this.opacity:t.opacity,f=this._isTallSymbol("visualVariables"in s&&s.visualVariables),g=wt(this.layer)||Ot(this.layer),_=r.reduce((e,t)=>e.concat(this._getAllInfos(t)),[]).filter(e=>!(!e||!e.symbol)).map(e=>this._getSymbolPreview(e,m,{applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:f,isSquareFill:g}}));return s=null,await Object(L["j"])(_),r}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){const t=null==e?void 0:e.infos;return t?t.reduce((e,t)=>e.concat(this._getAllInfos(t)),[]):[e]}_constructTileImageryStretchRendererElements(e){var t,a;const l=this.layer,i=l.rasterInfo,s=i.bandCount||e.statistics.length;let r,n,o=[];const c=i.keyProperties&&i.keyProperties.BandProperties,d=null!=e&&null!=(t=e.statistics)&&t.length?e.statistics:null==i?void 0:i.statistics;if(d)r=void 0!==d[0].min?d[0].min:d[0][0],n=d[0].max||d[0][1];else{const e=Ye[l.rasterInfo.pixelType.toLowerCase()];r=e[0],n=e[1]}if(1===i.bandCount||1===(null==(a=l.bandIds)?void 0:a.length))return this._getStretchLegendElements(e,{min:r,max:n});function y(e){var t;const a=(null!=l&&null!=(t=l.bandIds)&&t.length?l.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map(t=>e&&e[t]&&e[t].BandName||"band"+(t+1));return a.length<3?a.push(a[1]):a.length>3&&a.splice(3),a}return o=c&&c.length>=s?y(c):y(),this._createSymbolTableElementMultiBand(o)}_getStretchLegendElements(e,t){const a=e.colorRamp,l=ce(a,t);return{type:"stretch-ramp",title:"",infos:l,preview:Object(T["b"])(l.map(e=>e.color))}}_createSymbolTableElementMultiBand(e){const t=[],a=["red","green","blue"];return e.forEach((e,l)=>{t.push({label:{colorName:a[l],bandName:e},src:te[l],opacity:1})}),t}_updateInfosforClassedSizeRenderer(e,t){const a=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,l=e.classBreakInfos.some(e=>Object(z["h"])(e.symbol));if(a&&l){const a=_e,l=Le,i=e.classBreakInfos.length,s=(a-l)/(i>1?i-1:i);t.forEach((e,t)=>{e.size=a-s*t})}}_isTallSymbol(e){let t=!1,a=!1;if(e)for(let l=0;l<e.length&&(!t||!a);l++){const i=e[l];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(a=!0))}return t&&a}async _getSymbolPreview(e,t,l){let i=null==e.size&&this._hasSizeRamp?Object(j["h"])(22):e.size;if(this._scaleDrivenSizeVariable&&null!=l&&l.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(a.bind(null,"d297"));i=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}return Object(T["d"])(e.symbol,{size:i,opacity:t,scale:!1,symbolConfig:null==l?void 0:l.symbolConfig}).then(t=>(e.preview=t,e)).catch(()=>(e.preview=null,e))}async _loadRenderer(e){var t,a;const l=[],i=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const s="visualVariables"in e&&(null==(t=e.visualVariables)?void 0:t.some(e=>"size"===e.type&&"outline"!==e.target&&!Ke.test(e.valueExpression)));if(e&&"visualVariables"in e&&!s&&"featureReduction"in i&&"cluster"===(null==(a=i.featureReduction)?void 0:a.type)){const t=this.layerView._effectiveRenderer,a=Object(v["q"])(N(t,this.view));if(a){const t=i.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:l}=t;a.legendOptions=new R["a"]({showLegend:e!==l})}const l=e.visualVariables||[];e.visualVariables=l.concat([a]),this._hasClusterSizeVariable=!0}}const r=await this._getMedianColor(e);if(rt(e)||nt(e)){const t=(e.classBreakInfos||e.uniqueValueInfos).map(e=>this._fetchSymbol(e.symbol,r).then(t=>{e.symbol=t}).catch(()=>{e.symbol=null}));Array.prototype.push.apply(l,t)}return l.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:r).then(t=>{this._applySymbolToRenderer(e,t,st(e))}).catch(()=>{this._applySymbolToRenderer(e,null,st(e))})),Object(L["j"])(l).then(()=>e)}_applySymbolToRenderer(e,t,a){a?e.symbol=t:e.defaultSymbol=t}async _getMedianColor(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(e=>"color"===e.type);if(!t)return null;let l=null,i=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;l=t.stops[0].value,i=t.stops[t.stops.length-1].value}const s=l+(i-l)/2,{getColor:r}=await Promise.resolve().then(a.bind(null,"d297"));return r(t,s)}_fetchSymbol(e,t){if(!e)return Promise.reject();if("web-style"===e.type){const a=e.portal,l=a&&a.url,i=a&&a.user&&a.user.username,s=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+l+"-"+i,r=this._webStyleSymbolCache;return r.has(s)||("2d"===this.view.type?r.set(s,e.fetchCIMSymbol()):r.set(s,e.fetchSymbol())),r.get(s).then(e=>this._getAppliedCloneSymbol(e,t)).catch(()=>(Ue.warn("Fetching web-style failed!"),Promise.reject()))}return Promise.resolve(this._getAppliedCloneSymbol(e,t))}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const a=e.clone(),l=t&&t.toRgba();return a.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(a,l):"cim"===a.type?Object(x["a"])(a,t):a.color&&(a.color=new O["a"](l||a.color)),a}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(e=>{e&&(e.material||(e.material={}),e.material.color=new O["a"](t))})}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const a=e.visualVariables,l=[],i=[],s=[];for(const c of a)"color"===c.type?l.push(c):"size"===c.type?i.push(c):"opacity"===c.type&&s.push(c);const r=[...l,...i,...s];let n,o;if(0===l.length&&rt(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];n=t&&t.symbol}if(0===l.length&&st(e)&&(n=e.symbol),n)if(n.type.indexOf("3d")>-1){const e=n.symbolLayers.getItemAt(0);"water"===e.type?Object(v["k"])(e.color)&&(o=e.color):Object(v["k"])(e.material)&&Object(v["k"])(e.material.color)&&(o=e.material.color)}else n.url||(o=n.color);return(await Promise.all(r.map(async a=>{if(!a.legendOptions||!1!==a.legendOptions.showLegend){const l=this._getRampTitle(a,t);let i=null;const s="getField"in t&&t.getField&&t.getField(a.field),r=s&&Object(w["q"])(s);if("color"===a.type){const e=await ie(a,null,r);i={type:"color-ramp",title:l,infos:e,preview:Object(T["b"])(e.map(e=>e.color))},this._hasColorRamp||(this._hasColorRamp=!(null==i.infos||!i.infos.length))}else if("size"===a.type&&"outline"!==a.target)Ke.test(a.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=a):(i={type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(a):l,infos:await ze(e,a,await this._getMedianColor(e),this.scale,this.view.type,r)},this._hasSizeRamp||(this._hasSizeRamp=!(null==i.infos||!i.infos.length)));else if("opacity"===a.type){const e=await ie(a,o,r);i={type:"opacity-ramp",title:l,infos:e,preview:Object(T["b"])(e.map(e=>e.color))},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==i.infos||!i.infos.length))}return i&&i.infos?i:null}}))).filter(e=>!!e)}_getDomainName(e,t,a){if(e&&"function"!=typeof e){const l="getField"in a&&a.getField&&a.getField(e),i=l&&"getFieldDomain"in a&&a.getFieldDomain?a.getFieldDomain(l.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,a=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,l="popupTemplate"in e&&e.popupTemplate,i=l&&l.fieldInfos;if(i)for(const t of i)if(t.fieldName===a)return"cluster_count"===a?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let a=e.field,l=e.normalizationField,i=!1,s=!1,r=!1,n=null;a="function"==typeof a?null:a,l="function"==typeof l?null:l;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)n=o;else if(e.valueExpressionTitle)n=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const a=e[t];if("color"===a.type){if("ratio"===a.style){i=!0;break}if("percent"===a.style){s=!0;break}if("percent-of-total"===a.style){r=!0;break}}}}n={field:a&&this._getFieldAlias(a,t),normField:l&&this._getFieldAlias(l,t),ratio:i,ratioPercent:s,ratioPercentTotal:r}}return n}_getRendererTitle(e,t){const a=e;if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;let l=a.field,i=null,s=null;rt(a)&&(i=a.normalizationField,s="percent-of-total"===a.normalizationType),l="function"==typeof l?null:l,i="function"==typeof i?null:i;let r=null;return(l||i)&&(r={field:l&&this._getFieldAlias(l,t),normField:i&&this._getFieldAlias(i,t),normByPct:s}),r}_getFieldAlias(e,t){const a="popupTemplate"in t&&t.popupTemplate,l=a&&a.fieldInfos;let i=null;l&&l.some(t=>e===t.fieldName&&(i=t,!0));let s=null;"getField"in t&&t.getField?s=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(s=t.fieldsIndex.get(e));const r=i||s;let n=null;return r&&(n=i&&i.label||s&&s.alias||"name"in r&&r.name||"fieldName"in r&&r.fieldName),n}_isUnclassedRenderer(e){const t=e.visualVariables;let a=!1;return rt(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(a=e.field?t.some(t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)):!!t.length),a}};Object(l["a"])([Object(s["b"])()],Rt.prototype,"children",void 0),Object(l["a"])([Object(s["b"])()],Rt.prototype,"layerView",void 0),Object(l["a"])([Object(s["b"])()],Rt.prototype,"layer",void 0),Object(l["a"])([Object(s["b"])()],Rt.prototype,"legendElements",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0})],Rt.prototype,"opacity",null),Object(l["a"])([Object(s["b"])()],Rt.prototype,"parent",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0,dependsOn:[]})],Rt.prototype,"ready",null),Object(l["a"])([Object(s["b"])()],Rt.prototype,"keepCacheOnDestroy",void 0),Object(l["a"])([Object(s["b"])()],Rt.prototype,"respectLayerVisibility",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0})],Rt.prototype,"scale",null),Object(l["a"])([Object(s["b"])()],Rt.prototype,"sublayerIds",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0})],Rt.prototype,"isScaleDriven",null),Object(l["a"])([Object(s["b"])()],Rt.prototype,"title",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0,dependsOn:["ready"],value:0})],Rt.prototype,"version",null),Object(l["a"])([Object(s["b"])()],Rt.prototype,"view",void 0),Rt=Object(l["a"])([Object(o["a"])("esri.widgets.Legend.support.ActiveLayerInfo")],Rt);var xt=Rt,zt=xt;const Vt={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},kt=f["a"].ofType(zt),Tt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Ft="view.basemapView.baseLayerViews",Mt="view.groundView.layerViews",Bt="view.basemapView.referenceLayerViews",Nt=[Ft,Mt,"view.layerViews",Bt];let Dt=class extends m["a"]{constructor(e){super(e),this._handles=new d["a"],this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new f["a"],this.activeLayerInfos=new kt,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(Object(y["a"])(this,"view",this._viewHandles),Vt.view),this._handles.add(Object(g["c"])(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(Vt.state),this.view&&this._handles.add(Object(y["a"])(this,"state",this._stateHandles),Vt.state)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([Vt.allLayerViews,Vt.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),Vt.allLayerViews),this._handles.add(Object(y["d"])(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),Vt.legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach(e=>this._destroyViewActiveLayerInfo(e.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach(a=>{if(!a.parent){const l=a.layer.parent,i=l&&"uid"in l&&this._layerViewByLayerId[l.uid],s=i&&this._activeLayerInfosByLayerViewId[i.uid];s&&-1!==e.indexOf(s)&&(t.push(a),a.parent=s,s.children.add(a),this._sortActiveLayerInfos(s.children))}}),e.removeMany(t);const a={};this.view.allLayerViews.forEach((e,t)=>a[e.layer.uid]=t),e.sort((e,t)=>{const l=a[e.layer.uid]||0;return(a[t.layer.uid]||0)-l})}_generateLayerViews(){const e=[];return Nt.filter(this._filterLayerViews,this).map(this.get,this).filter(e=>null!=e).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===Ft||e===Bt),a=!this.groundLegendVisible&&e===Mt;return!t&&!a}_collectLayerViews(e,t){const a=l=>(l&&l.forEach(l=>{t.push(l),a(l[e])}),t);return a}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some(t=>this._hasLayerInfo(t,e))}_hasLayerInfo(e,t){const a=this._isLayerUIDMatching(e.layer,t.layer.uid);return a&&(this._layerInfosByLayerViewId[t.uid]=e),a}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(e=>this._isLayerUIDMatching(e,t))}_isLayerViewSupported(e){return Tt.indexOf(e.layer.declaredClass)>-1&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(Object(y["d"])(e,"legendEnabled, layer.legendEnabled",()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var t;const a=e.layer,l=e.uid,i=this._layerInfosByLayerViewId[l];let s=this._activeLayerInfosByLayerViewId[l];if(!s){const t=i&&void 0!==i.title&&i.layer.uid===a.uid;s=new zt({layer:a,layerView:e,title:t?i.title:a.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:i&&i.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[l]=s}const r=a.parent&&"uid"in a.parent&&this._layerViewByLayerId[null==(t=a.parent)?void 0:t.uid];if(s.parent=this._activeLayerInfosByLayerViewId[null==r?void 0:r.uid],!this._handles.has(l)){const t=[Object(y["d"])(a,"title",e=>this._titleHandle(e,s)),Object(y["d"])(a,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",()=>this._constructLegendElements(s)),Object(y["k"])(this.view,"stationary",()=>this._scaleHandle(s)),Object(y["d"])(e,"_effectiveRenderer",()=>this._constructLegendElements(s))];if(this.respectLayerVisibility){const l=Object(y["d"])(e,"legendEnabled",e=>this._legendEnabledHandle(e,s)),i=Object(y["d"])(a,"legendEnabled",e=>this._legendEnabledHandle(e,s));t.push(l,i)}this._handles.add(t,l)}s.isScaleDriven||this._constructLegendElements(s),this._addActiveLayerInfo(s)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){e.isScaleDriven&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:a}=e;if(this._isLayerActive(t)&&-1===this.activeLayerInfos.indexOf(e)){const t=e.parent;if(t)-1===t.children.indexOf(e)&&t.children.push(e),this._sortActiveLayerInfos(t.children);else{var l;const t=null==(l=this.layerInfos)?void 0:l.some(e=>e.layer.uid===a.uid);a.parent&&"uid"in a.parent&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach(t=>{const a=t.layer.parent,l=a&&"uid"in a&&this._layerViewByLayerId[null==a?void 0:a.uid],i=this._activeLayerInfosByLayerViewId[null==l?void 0:l.uid];i&&(e.push(t),t.parent=i)}),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach(e=>this._addActiveLayerInfo(e)))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach(e=>this._constructLegendElements(e))}};Object(l["a"])([Object(s["b"])({type:kt})],Dt.prototype,"activeLayerInfos",void 0),Object(l["a"])([Object(s["b"])()],Dt.prototype,"basemapLegendVisible",void 0),Object(l["a"])([Object(s["b"])()],Dt.prototype,"groundLegendVisible",void 0),Object(l["a"])([Object(s["b"])()],Dt.prototype,"keepCacheOnDestroy",void 0),Object(l["a"])([Object(s["b"])()],Dt.prototype,"respectLayerVisibility",void 0),Object(l["a"])([Object(s["b"])()],Dt.prototype,"layerInfos",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0})],Dt.prototype,"state",null),Object(l["a"])([Object(s["b"])()],Dt.prototype,"view",void 0),Dt=Object(l["a"])([Object(o["a"])("esri.widgets.Legend.LegendViewModel")],Dt);var Pt=Dt,qt=Pt,Ht=a("255d"),$t=a("8750"),Ut=a("ef01");const Wt="http://www.w3.org/2000/svg",Gt={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function Jt(e,t,a){const{focus:l,labels:i}=e,s=!!l,r=Kt(e,t,a);return s?Object(b["a"])("div",{class:Gt.diamondContainer},Object(b["a"])("div",{class:Gt.diamondLeftCol},i.left),Object(b["a"])("div",{class:Gt.diamondMidCol},Object(b["a"])("div",{class:Gt.diamondMidColLabel},i.top),r,Object(b["a"])("div",{class:Gt.diamondMidColLabel},i.bottom)),Object(b["a"])("div",{class:Gt.diamondRightCol},i.right)):Object(b["a"])("div",{class:Gt.squareTable},Object(b["a"])("div",{class:Gt.squareTableRow},Object(b["a"])("div",{class:Object(u["a"])(Gt.squareTableCell,Gt.squareTableLabel,Gt.squareTableLabelRightBottom)},i.left),Object(b["a"])("div",{class:Gt.squareTableCell}),Object(b["a"])("div",{class:Object(u["a"])(Gt.squareTableCell,Gt.squareTableLabel,Gt.squareTableLabelLeftBottom)},i.top)),Object(b["a"])("div",{class:Gt.squareTableRow},Object(b["a"])("div",{class:Gt.squareTableCell}),r,Object(b["a"])("div",{class:Gt.squareTableCell})),Object(b["a"])("div",{class:Gt.squareTableRow},Object(b["a"])("div",{class:Object(u["a"])(Gt.squareTableCell,Gt.squareTableLabel,Gt.squareTableLabelRightTop)},i.bottom),Object(b["a"])("div",{class:Gt.squareTableCell}),Object(b["a"])("div",{class:Object(u["a"])(Gt.squareTableCell,Gt.squareTableLabel,Gt.squareTableLabelLeftTop)},i.right)))}function Qt(e,t,a){const l=a+"_arrowStart",i=a+"_arrowEnd",s="left"===e,r={markerStart:null,markerEnd:null};switch(t){case"HL":s?r.markerStart=`url(#${i})`:r.markerEnd=`url(#${l})`;break;case"LL":r.markerStart=`url(#${i})`;break;case"LH":s?r.markerEnd=`url(#${l})`:r.markerStart=`url(#${i})`;break;default:r.markerEnd=`url(#${l})`}return r}function Kt(e,t,a,l=60){const{focus:i,numClasses:s,colors:r,rotation:n}=e,o=!!i,c=Math.sqrt(l**2+l**2)+(o?0:5);let d=null;null!=a&&(d="opacity: "+a);const y=[],u=[],h=[],p=(l||75)/s;for(let b=0;b<s;b++){const e=b*p;for(let t=0;t<s;t++){const a=t*p,l=Object(Ut["b"])(r[b][t]),i=Object(Ut["c"])(null),s={type:"rect",x:a,y:e,width:p,height:p};y.push(Object(Ut["f"])(l)),u.push(Object(Ut["h"])(s,l.fill,i,null)),h.push(Object(Ut["d"])(s))}}const m=10,f=15,g=15,v=10;let _=null;o||(_="margin: -15px -15px -18px -15px");const L=Qt("left",i,t),w=Qt("right",i,t),O=Object(Ut["a"])(h),j=Object(Ut["e"])(O,c,c,0,!1,n,!1),S=Object(Ut["e"])(O,c,c,0,!1,o?-45:null,!1);return Object(b["a"])("div",{style:d,class:o?Gt.diamondMidColRamp:Gt.squareTableCell},Object(b["a"])("svg",{xmlns:Wt,width:c,height:c,style:_},Object(b["a"])("defs",null,Object(b["a"])("marker",{id:t+"_arrowStart",markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},Object(b["a"])("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),Object(b["a"])("marker",{id:t+"_arrowEnd",markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},Object(b["a"])("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),y),Object(b["a"])("g",{transform:j},u),Object(b["a"])("g",{transform:S},Object(b["a"])("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":L.markerStart,"marker-end":L.markerEnd,x1:-m,y1:l-f,x2:-m,y2:f}),Object(b["a"])("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":w.markerStart,"marker-end":w.markerEnd,x1:g,y1:l+v,x2:l-g,y2:l+v}))))}a("e6c2");var Xt=a("69e9");const Yt=Object(Xt["a"])(),Zt=10,ea=20,ta=10,aa=20,la={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function ia(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?Object(b["a"])("svg",{height:"4",width:"10"},Object(b["a"])("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):Object(b["a"])("svg",{height:"10",width:"10"},Object(b["a"])("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function sa(e,t="vertical"){const a=document.createElement("div");return a.style.height=ea+"px",a.className=la.univariateAboveAndBelowSymbol,null!=e&&(a.style.opacity=e.toString()),Yt.append(a,ia.bind(null,t)),a}function ra(e,t,a="vertical",l){e.infos.forEach((e,i)=>{if(l&&2===i)e.preview=sa(t,a);else{const t=Object(j["g"])(e.size)+("horizontal"===a?aa:ta),l="div"===e.preview.tagName.toLowerCase(),i=l?e.preview:document.createElement("div");i.className=la.univariateAboveAndBelowSymbol,"horizontal"===a?i.style.width=t+"px":i.style.height=t+"px",l||i.appendChild(e.preview),e.preview=i}})}function na(e,t="classic"){const a=e.infos;return"classic"===t?(Object(j["g"])(a[0].size)+ta)/2:(Object(j["g"])(a[0].size)-Object(j["g"])(a[a.length-1].size))/2}function oa(e,t){if(!e)return null;const a=e.infos.map(e=>e.color),l=Object(T["b"])("full"===t.type?a:"above"===t.type?a.slice(0,3):a.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment});return l.className=la.colorRamp,null!=t.opacity&&(l.style.opacity=t.opacity.toString()),l}function ca(e,t,a,l="vertical"){let i=0;const s=e.infos,r=Math.floor(s.length/2),n="full"===t||"above"===t?0:r,o="full"===t||"below"===t?s.length-1:r;for(let c=n;c<=o;c++)i+=a&&c===r?"horizontal"===l?Zt:ea:Object(j["g"])(s[c].size)+("horizontal"===l?aa:ta);return Math.round(i)}function da(e,t,a,l="vertical"){const i=ca(e,t,a,l),s=e.infos,r=Math.floor(s.length/2),n="full"===t||"above"===t?0:r,o="full"===t||"below"===t?s.length-1:r,c="full"===t?s[n].size+s[o].size:"above"===t?s[n].size:s[o].size,d=a?"vertical"===l?ea:Zt:0,y="vertical"===l?ta*("full"===t?2:1):aa*("full"===t?2:1);return Math.round(i-(Object(j["g"])(c)/2+d/2+y/2))}function ya(e,t,a="vertical"){const l=e.infos;let i=l.filter(({type:e})=>"size-ramp"===e)[0],s=l.filter(({type:e})=>"color-ramp"===e)[0];var r;return i&&(i={...i},i.infos=[...i.infos]),s&&(s={...s},s.infos=[...s.infos]),ra(i,t,a,!0),"horizontal"===a&&(i.infos.reverse(),null==(r=s)||r.infos.reverse()),{sizeRampElement:i,colorRampElement:s}}function ua(e,t="vertical"){const a=e.infos;let l=a.filter(({type:e})=>"size-ramp"===e)[0],i=a.filter(({type:e})=>"color-ramp"===e)[0];var s;return l&&(l={...l},l.infos=[...l.infos]),i&&(i={...i},i.infos=[...i.infos]),ra(l,null,t,!1),"horizontal"===t&&(l.infos.reverse(),null==(s=i)||s.infos.reverse()),{sizeRampElement:l,colorRampElement:i}}function ha(e,t){return t}function ba(e){const t=this;e.appendChild(t)}function pa(e,t,a){if(!t)return;if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return Object(Ht["a"])(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let l=null;return ha(t,a)?l=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:ma(t,a)&&(l=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),l?Object(Ht["a"])("showField"===l?"{field}":e[l],{field:t.field,normField:t.normField}):null}function ma(e,t){return!t}function fa(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}const ga={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden",header:"esri-widget__heading"},va=25,_a=25,La=768,wa=100,Oa="#ddd",ja=window.devicePixelRatio;function Sa(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const a=e.symbolLayers.getItemAt(t-1),l=a.resource&&a.resource.primitive;return"circle"===l||"cross"===l||"kite"===l||"sphere"===l||"cube"===l||"diamond"===l}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}function Ia(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const a=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===a||"cone"===a||"tetrahedron"===a}return"triangle"===e.style}}let Ca=class extends p["a"]{constructor(e,t){super(e,t),this._handles=new d["a"],this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own([this.watch("activeLayerInfos",e=>{this._handles.removeAll(),this._watchForSectionChanges(e)})])}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=La||"stack"===this.layout;const e=this.activeLayerInfos,t=e&&e.toArray().map(e=>this._renderLegendForLayer(e)).filter(e=>!!e);this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const a=this._sectionNames.length,l=this._sectionNames.map((e,t)=>{const l=Object(Ht["a"])(this.messagesCommon.pagination.pageText,{index:t+1,total:a});return Object(b["a"])("div",{key:e,role:"tab",id:e,"aria-label":l,"aria-controls":e+"-panel","aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:l,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(ga.indicator,{[ga.activated]:this._selectedSectionName===e}),"data-section-name":e})}),i=this._hasIndicators&&a>1?Object(b["a"])("div",{class:ga.indicatorContainer,key:"carousel-navigation",role:"tablist"},l):null,s=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,r={[ga.stacked]:this._hasIndicators};return Object(b["a"])("div",{class:this.classes(ga.base,r)},s||Object(b["a"])("div",{class:ga.message},this.messages.noLegend),i)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,a="ArrowLeft"===t?-1:1,l=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(l),s=this._sectionNames;let r=null;-1!==i&&(s[i+a]?r=document.getElementById(s[i+a]):"ArrowLeft"===t?r=document.getElementById(s[s.length-1]):"ArrowRight"===t&&(r=document.getElementById(s[0])),r&&r.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",()=>this._generateSectionNames()),t)});const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,a){return`${this.id}${e.uid}-type-${t.type}-${a}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,a)=>{this._sectionNames.push(this._getSectionName(e.layer,t,a))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map(e=>this._renderLegendForLayer(e)).toArray();return Object(b["a"])("div",{key:e.layer.uid,class:this.classes(ga.service,ga.groupLayer)},Object(b["a"])("div",{class:ga.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const a=t.some(e=>"relationship-ramp"===e.type),l=t.map((t,l)=>this._renderLegendForElement(t,e,l,a)).filter(e=>!!e);if(!l.length)return null;const i={[ga.groupLayerChild]:!!e.parent};return Object(b["a"])("div",{key:e.layer.uid,class:this.classes(ga.service,i)},Object(b["a"])("div",{class:ga.serviceCaptionContainer},Object(b["a"])("div",{class:ga.serviceCaptionText},e.title)),Object(b["a"])("div",{class:ga.serviceContent},l))}}_renderLegendForElement(e,t,a,l=!1){const i="color-ramp"===e.type,s="opacity-ramp"===e.type,r="size-ramp"===e.type,n=t.layer,o=e.title;let c=null;if("string"==typeof o)c=o;else if(o){const e=pa(this.messages,o,i||s);c=o.title?`${o.title} (${e})`:e}const d=this._getSectionName(n,e,a),y=this._hasIndicators?Object(b["a"])("div",null,Object(b["a"])("h3",{class:this.classes(ga.header,ga.carouselTitle)},t.title),Object(b["a"])("h4",{class:this.classes(ga.header,ga.layerCaption)},c)):c?Object(b["a"])("h4",{class:this.classes(ga.header,ga.layerCaption)},c):null;let u=null;if("symbol-table"===e.type){const a=e.infos.map((a,l)=>this._renderLegendForElementInfo(a,t,e.legendType,l)).filter(e=>!!e);if(a.length){const e=a[0].properties.classes&&a[0].properties.classes[ga.symbolRow],t={[ga.labelContainer]:!e&&!l,[ga.relationshipLabelContainer]:l};u=Object(b["a"])("div",{class:this.classes(t)},a)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?u=this._renderLegendForRamp(e,n.opacity):r?u=this._renderSizeRamp(e,n.opacity):"relationship-ramp"===e.type?u=Jt(e,this.id,n.opacity):"univariate-above-and-below-ramp"===e.type?u=this._renderUnivariateAboveAndBelowRamp(e,n.opacity):"univariate-color-size-ramp"===e.type&&(u=this._renderUnivariateColorSizeRamp(e,n.opacity));if(!u)return null;const h=Object(b["a"])("div",{key:d,class:ga.section,id:d+"-panel",role:"tabpanel","aria-labelledby":d,tabIndex:0},[y,u]);return this._sectionMap.set(d,h),h}_renderUnivariateAboveAndBelowRamp(e,t){const{sizeRampElement:a,colorRampElement:l}=ya(e,t,"horizontal"),i=ca(a,"full",!0,"horizontal"),s=da(a,"above",!0,"horizontal"),r=da(a,"below",!0,"horizontal"),n=12,o=oa(l,{width:s,height:n,rampAlignment:"horizontal",opacity:t,type:"above"}),c=oa(l,{width:r,height:n,rampAlignment:"horizontal",opacity:t,type:"below"}),d=na(a,"card"),y=a.infos.map(e=>e.label),u=y.length-1,h=y.map((e,t)=>0===t||t===u?Object(b["a"])("div",{key:t},e):null),p={display:"flex",flexDirection:"column"},m={display:"flex",flexDirection:"row"},f={marginTop:"3px",marginLeft:d+"px",display:"flex"},g={width:i+"px",display:"flex",flexDirection:"row",justifyContent:"space-between"};return Object(b["a"])("div",{class:ga.layerRow,key:"size-ramp-preview",styles:p},Object(b["a"])("div",{class:this.classes(ga.symbolContainer,ga.sizeRampHorizontal),styles:m},a.infos.map((e,t)=>Object(b["a"])("div",{key:t,class:ga.symbol,bind:e.preview,afterCreate:ba}))),o?Object(b["a"])("div",{class:ga.univariateAboveAndBelowColorRamp,styles:f,key:"color-ramp-preview"},Object(b["a"])("div",{bind:o,afterCreate:ba}),Object(b["a"])("div",{bind:c,afterCreate:ba})):null,Object(b["a"])("div",{class:ga.layerInfo},Object(b["a"])("div",{class:ga.rampLabelsContainer,styles:g},h)))}_renderUnivariateColorSizeRamp(e,t){const{sizeRampElement:a,colorRampElement:l}=ua(e,"horizontal"),i=ca(a,"full",!1,"horizontal"),s=da(a,"full",!1,"horizontal"),r=oa(l,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"full"}),n=na(a,"card"),o=a.infos.length-1,c=a.infos.map((e,t)=>0===t||t===o?Object(b["a"])("div",{key:t},e.label):null),d={display:"flex",flexDirection:"column"},y={display:"flex",flexDirection:"row"},u={marginTop:"3px",marginLeft:n+"px",display:"flex"},h={width:i+"px",display:"flex",flexDirection:"row",justifyContent:"space-between"};return Object(b["a"])("div",{class:ga.layerRow,key:"size-ramp-preview",styles:d},Object(b["a"])("div",{class:this.classes(ga.symbolContainer,ga.sizeRampHorizontal),styles:y},a.infos.map((e,t)=>Object(b["a"])("div",{key:t,class:ga.symbol,bind:e.preview,afterCreate:ba}))),Object(b["a"])("div",{class:ga.univariateAboveAndBelowColorRamp,styles:u,key:"color-ramp-preview"},Object(b["a"])("div",{bind:r,afterCreate:ba})),Object(b["a"])("div",{class:ga.layerInfo},Object(b["a"])("div",{class:ga.rampLabelsContainer,styles:h},c)))}_renderLegendForElementInfo(e,t,a,l){const i=t.layer;if(e.type)return this._renderLegendForElement(e,t,l);const s=fa(i,a);if(e.preview){var r,n;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return Object(b["a"])("div",{key:l,bind:e.preview,afterCreate:ba});const t={[ga.symbolCell]:this._hasIndicators};return Object(b["a"])("div",{key:l,class:this.classes(ga.layerRow,{[ga.symbolRow]:this._hasIndicators})},Object(b["a"])("div",{class:this.classes(t),bind:e.preview,afterCreate:ba}),Object(b["a"])("div",{class:this.classes(ga.imageLabel,{[ga.labelCell]:this._hasIndicators})},pa(this.messages,e.label,!1)||""))}let t=255,a=255,s=255,o=0,c=255,d=255,y=255,u=0;const h=e.symbol.color&&e.symbol.color.a,p=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;h&&(t=e.symbol.color.r,a=e.symbol.color.g,s=e.symbol.color.b,o=e.symbol.color.a*i.opacity),p&&(c=e.symbol.outline.color.r,d=e.symbol.outline.color.g,y=e.symbol.outline.color.b,u=e.symbol.outline.color.a*i.opacity);const m=null==(r=null==(n=e.symbol.color)?void 0:n.isBright)||r,f=m?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",g={background:h?`rgba(${t}, ${a}, ${s}, ${o})`:"none",color:m?"black":"white",textShadow:`-1px -1px 0 ${f},\n                                              1px -1px 0 ${f},\n                                              -1px 1px 0 ${f},\n                                              1px 1px 0 ${f}`,border:p?`1px solid rgba(${c}, ${d}, ${y}, ${u})`:"none"};return Object(b["a"])("div",{key:l,class:ga.layerRow},Object(b["a"])("div",{class:ga.labelElement,styles:g}," ",e.label," "))}if(e.src){const t=this._renderImage(e,i,s);return Object(b["a"])("div",{key:l,class:ga.layerRow},t,Object(b["a"])("div",{class:ga.imageLabel},e.label||""))}}_renderImage(e,t,a){const{label:l,src:i,opacity:s}=e,r={[ga.imageryLayerStretchedImage]:a,[ga.symbol]:!a},n={opacity:""+(null!=s?s:t.opacity)};return Object(b["a"])("img",{alt:pa(this.messages,l,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(r),styles:n})}_renderSizeRampLines(e){const t=e.infos,a=t[0],l=t[t.length-1],i=a.symbol,s=this._hasIndicators,r=Object(j["g"])(a.size+a.outlineSize)*ja,n=Object(j["g"])(l.size+l.outlineSize)*ja,o=s?r:r+50*ja,c=s?r/2+50*ja:r,d=Ia(i),y=Sa(i),u=document.createElement("canvas");u.width=o,u.height=c,u.style.width=u.width/ja+"px",u.style.height=u.height/ja+"px";const h=u.getContext("2d");if(s){h.beginPath();const e=0,t=0,a=o/2-n/2,l=c;h.moveTo(e,t),h.lineTo(a,l);const i=o,s=0,r=o/2+n/2,d=c;h.moveTo(i,s),h.lineTo(r,d)}else{h.beginPath();const e=0,t=c/2-n/2,a=o,l=0;h.moveTo(e,t),h.lineTo(a,l);const i=0,s=c/2+n/2,r=o,d=c;h.moveTo(i,s),h.lineTo(r,d)}return h.strokeStyle=Oa,h.stroke(),Object(b["a"])("div",{bind:u,afterCreate:ba,styles:s?{display:"flex",marginTop:`-${d?0:y?r/2:0}px`,marginBottom:`-${d?n:y?n/2:0}px`}:{display:"flex",marginRight:`-${d?0:y?r/2:0}px`,marginLeft:`-${d?0:y?n/2:0}px`}})}_renderSizeRamp(e,t){const a=e.infos,l=a[0].label,i=a[a.length-1].label;let s=a[0].preview,r=a[a.length-1].preview;const n=this._hasIndicators,o={"flex-direction":n?"column":"row-reverse"};s&&(s=s.cloneNode(!0),s.style.display="flex"),r&&(r=r.cloneNode(!0),r.style.display="flex");const c={opacity:null!=t?""+t:""};return Object(b["a"])("div",{class:this.classes(ga.layerRow,{[ga.sizeRampRow]:n})},Object(b["a"])("div",{class:ga.rampLabel},n?l:i),Object(b["a"])("div",{class:ga.sizeRampContainer,styles:o},Object(b["a"])("div",{bind:s,afterCreate:ba,class:ga.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),Object(b["a"])("div",{bind:r,afterCreate:ba,class:ga.sizeRampContainer,styles:c})),Object(b["a"])("div",{class:ga.rampLabel},n?i:l))}_renderLegendForRamp(e,t){const a=e.infos,l="heatmap-ramp"===e.type,i=a.length-1,s=_a,r=i>2&&!l?va*i:wa,n=r+20,o=10,c=a.slice(0).reverse();c.forEach((e,t)=>{e.offset=l?e.ratio:t/i});const d=c.length-1,y=c.length%2!=0&&c[c.length/2|0],u=y&&Object(b["a"])("div",{class:ga.intervalSeparatorsContainer},Object(b["a"])("div",{class:ga.intervalSeparator},"|"),Object(b["a"])("div",{class:ga.rampLabel},y.label)),h=a[a.length-1].label,p=a[0].label;let m=null;null!=t&&(m="opacity: "+t);const f=[[{shape:{type:"path",path:`M0 ${s/2} L${o} 0 L${o} ${s} Z`},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:o,y:0,width:r,height:s},fill:{type:"linear",x1:o,y1:0,x2:r+o,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:`M${r+o} 0 L${n} ${s/2} L${r+o} ${s} Z`},fill:c[d].color,stroke:{width:0}}]],g=Object(Ut["g"])(f,n,s),{messages:v}=this;return Object(b["a"])("div",{class:ga.layerRow},Object(b["a"])("div",{class:ga.rampLabel},l?v[h]:h),Object(b["a"])("div",{class:ga.symbolContainer},Object(b["a"])("div",{style:m},g),u),Object(b["a"])("div",{class:ga.rampLabel},l?v[p]:p))}};Object(l["a"])([Object(s["b"])()],Ca.prototype,"activeLayerInfos",void 0),Object(l["a"])([Object(s["b"])()],Ca.prototype,"layout",void 0),Object(l["a"])([Object(s["b"])(),Object(h["a"])("esri/widgets/Legend/t9n/Legend")],Ca.prototype,"messages",void 0),Object(l["a"])([Object(s["b"])(),Object(h["a"])("esri/t9n/common")],Ca.prototype,"messagesCommon",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0})],Ca.prototype,"type",void 0),Object(l["a"])([Object(s["b"])()],Ca.prototype,"view",void 0),Object(l["a"])([Object($t["a"])()],Ca.prototype,"_selectSection",null),Ca=Object(l["a"])([Object(o["a"])("esri.widgets.Legend.styles.Card")],Ca);var Aa=Ca,Ea=Aa;const Ra={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},xa="esri-legend__",za=24,Va={display:"flex",alignItems:"flex-start"},ka={marginLeft:"3px"},Ta={display:"table-cell",verticalAlign:"middle"};let Fa=class extends p["a"]{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map(e=>this._renderLegendForLayer(e)).filter(e=>!!e);return Object(b["a"])("div",null,t&&t.length?t:Object(b["a"])("div",{class:Ra.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,a=`${xa}${e.layer.uid}-version-${e.version}`,l=e.title?Object(b["a"])("h3",{class:this.classes(Ra.header,Ra.label)},e.title):null;if(t){const t=e.children.map(e=>this._renderLegendForLayer(e)).toArray();return Object(b["a"])("div",{key:a,class:this.classes(Ra.service,Ra.groupLayer)},l,t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.map(t=>this._renderLegendForElement(t,e.layer)).filter(e=>!!e);if(!i.length)return null;const s={[Ra.groupLayerChild]:!!e.parent};return Object(b["a"])("div",{key:a,class:this.classes(Ra.service,s),tabIndex:0},l,Object(b["a"])("div",{class:Ra.layer},i))}}_renderLegendForElement(e,t,a){const l="color-ramp"===e.type,i="opacity-ramp"===e.type,s="size-ramp"===e.type;let r=null;if("symbol-table"===e.type||s){const a=e.infos.map(a=>this._renderLegendForElementInfo(a,t,s,e.legendType)).filter(e=>!!e);a.length&&(r=Object(b["a"])("div",{class:Ra.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?r=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?r=Jt(e,this.id,t.opacity):"univariate-above-and-below-ramp"===e.type?r=this._renderUnivariateAboveAndBelowRamp(e,t.opacity):"univariate-color-size-ramp"===e.type&&(r=this._renderUnivariateColorSizeRamp(e,t.opacity));if(!r)return null;const n=e.title;let o=null;if("string"==typeof n)o=n;else if(n){const e=pa(this.messages,n,l||i);o=ma(n,l||i)&&n.title?`${n.title} (${e})`:e}const c=a?Ra.layerChildTable:Ra.layerTable,d=o?Object(b["a"])("div",{class:Ra.layerCaption},o):null,y={[Ra.layerTableSizeRamp]:s||!a};return Object(b["a"])("div",{class:this.classes(c,y)},d,r)}_renderUnivariateAboveAndBelowRamp(e,t){const{sizeRampElement:a,colorRampElement:l}=ya(e,t),i=da(a,"above",!0),s=da(a,"below",!0),r=12,n=oa(l,{width:r,height:i,rampAlignment:"vertical",opacity:t,type:"above"}),o=oa(l,{width:r,height:s,rampAlignment:"vertical",opacity:t,type:"below"}),c=na(a),d=a.infos.map(e=>e.label),y=d.map((e,t)=>{const a=2===t;return 0===t?Object(b["a"])("div",{key:t,class:e?n?Ra.univariateAboveAndBelowLabel:Ra.rampLabel:null},e):a?Object(b["a"])("div",null):null}),u=d.length-1,h=Math.floor(d.length/2),p=d.map((e,t)=>t===h||t===u?Object(b["a"])("div",{key:t,class:e?n?Ra.univariateAboveAndBelowLabel:Ra.rampLabel:null},e):null),m={display:"table-cell",verticalAlign:"middle"},f={marginTop:c+"px"},g={height:i+"px"},v={height:s+"px"};return Object(b["a"])("div",{key:"univariate-above-and-below-ramp-preview",styles:Va},Object(b["a"])("div",{class:Ra.layerBody},a.infos.map((e,t)=>Object(b["a"])("div",{class:this.classes(Ra.layerRow,Ra.sizeRamp)},Object(b["a"])("div",{class:Ra.symbol,styles:m,bind:e.preview,afterCreate:ba}),n||t%2!=0?null:Object(b["a"])("div",{class:Ra.layerInfo},d[t])))),n?Object(b["a"])("div",{styles:f,key:"color-ramp-preview"},Object(b["a"])("div",{styles:ka},Object(b["a"])("div",{styles:Ta},Object(b["a"])("div",{class:Ra.rampContainer,bind:n,afterCreate:ba})),Object(b["a"])("div",{styles:Ta},Object(b["a"])("div",{class:Ra.rampLabelsContainer,styles:g},y))),Object(b["a"])("div",{styles:ka},Object(b["a"])("div",{styles:Ta},Object(b["a"])("div",{class:Ra.rampContainer,bind:o,afterCreate:ba})),Object(b["a"])("div",{styles:Ta},Object(b["a"])("div",{class:Ra.rampLabelsContainer,styles:v},p)))):null)}_renderUnivariateColorSizeRamp(e,t){const{sizeRampElement:a,colorRampElement:l}=ua(e),i=na(a),s=12,r=da(a,"full",!1),n=oa(l,{width:s,height:r,rampAlignment:"vertical",opacity:t,type:"full"}),o=a.infos.length-1,c=a.infos.map((e,t)=>0===t||t===o?Object(b["a"])("div",{key:t,class:e.label?l?Ra.univariateAboveAndBelowLabel:Ra.rampLabel:null},e.label):null),d={display:"table-cell",verticalAlign:"middle"},y={marginTop:i+"px"},u={height:r+"px"};return Object(b["a"])("div",{key:"univariate-above-and-below-ramp-preview",styles:Va},Object(b["a"])("div",{class:Ra.layerBody},a.infos.map(e=>Object(b["a"])("div",{class:this.classes(Ra.layerRow,Ra.sizeRamp)},Object(b["a"])("div",{class:Ra.symbol,styles:d,bind:e.preview,afterCreate:ba})))),Object(b["a"])("div",{styles:y,key:"color-ramp-preview"},Object(b["a"])("div",{styles:ka},Object(b["a"])("div",{styles:Ta},Object(b["a"])("div",{class:Ra.rampContainer,bind:n,afterCreate:ba})),Object(b["a"])("div",{styles:Ta},Object(b["a"])("div",{class:Ra.rampLabelsContainer,styles:u},c)))))}_renderLegendForRamp(e,t){const a=e.infos,l="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,s="stretch-ramp"===e.type,r=e.preview,n=l?Ra.opacityRamp:"";r.className=`${Ra.colorRamp} ${n}`,null!=t&&(r.style.opacity=t.toString());const o=a.map(e=>Object(b["a"])("div",{class:e.label?Ra.rampLabel:null},i?this.messages[e.label]:s?this._getStretchStopLabel(e):e.label)),c={width:za+"px"},d={height:r.style.height};return Object(b["a"])("div",{class:Ra.layerRow},Object(b["a"])("div",{class:Ra.symbolContainer,styles:c},Object(b["a"])("div",{class:Ra.rampContainer,bind:r,afterCreate:ba})),Object(b["a"])("div",{class:Ra.layerInfo},Object(b["a"])("div",{class:Ra.rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+Object(P["b"])(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""}_renderLegendForElementInfo(e,t,a,l){if(e.type)return this._renderLegendForElement(e,t,!0);let i=null;const s=fa(t,l);if(e.preview?i=Object(b["a"])("div",{class:Ra.symbol,bind:e.preview,afterCreate:ba}):e.src&&(i=this._renderImage(e,t,s)),!i)return null;const r={[Ra.imageryLayerInfoStretched]:s},n={[Ra.imageryLayerInfoStretched]:s,[Ra.sizeRamp]:!s&&a};return Object(b["a"])("div",{class:Ra.layerRow},Object(b["a"])("div",{class:this.classes(Ra.symbolContainer,n)},i),Object(b["a"])("div",{class:this.classes(Ra.layerInfo,r)},pa(this.messages,e.label,!1)||""))}_renderImage(e,t,a){const{label:l,src:i,opacity:s}=e,r={[Ra.imageryLayerStretchedImage]:a,[Ra.symbol]:!a},n={opacity:""+(null!=s?s:t.opacity)};return Object(b["a"])("img",{alt:pa(this.messages,l,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(r),styles:n})}};Object(l["a"])([Object(s["b"])()],Fa.prototype,"activeLayerInfos",void 0),Object(l["a"])([Object(s["b"])(),Object(h["a"])("esri/widgets/Legend/t9n/Legend")],Fa.prototype,"messages",void 0),Object(l["a"])([Object(s["b"])({readOnly:!0})],Fa.prototype,"type",void 0),Fa=Object(l["a"])([Object(o["a"])("esri.widgets.Legend.styles.Classic")],Fa);var Ma=Fa,Ba=Ma;const Na={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let Da=class extends p["a"]{constructor(e,t){super(e,t),this._handles=new d["a"],this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=Na.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new Ba,this.view=null,this.viewModel=new qt}initialize(){this.own(Object(y["b"])(this,"activeLayerInfos","change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),Object(y["a"])(this,"style",(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))}))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof Ea||e instanceof Ba)return e;if("string"==typeof e)return"card"===e?new Ea:new Ba;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?Ea:Ba)(t)}return new Ba}render(){return Object(b["a"])("div",{class:this.classes(Na.base,Na.widget,this.style instanceof Ba?Na.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach(e=>this._renderOnActiveLayerInfoChange(e)),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=Object(y["a"])(e,"version",()=>this.scheduleRender());this._handles.add(t,"version_"+e.layer.uid);const a=Object(y["b"])(e,"children","change",()=>{e.children.forEach(e=>this._renderOnActiveLayerInfoChange(e))});this._handles.add(a,"children_"+e.layer.uid),e.children.forEach(e=>this._renderOnActiveLayerInfoChange(e))}};Object(l["a"])([Object(r["a"])("viewModel.activeLayerInfos")],Da.prototype,"activeLayerInfos",void 0),Object(l["a"])([Object(r["a"])("viewModel.basemapLegendVisible")],Da.prototype,"basemapLegendVisible",void 0),Object(l["a"])([Object(r["a"])("viewModel.groundLegendVisible")],Da.prototype,"groundLegendVisible",void 0),Object(l["a"])([Object(r["a"])("viewModel.keepCacheOnDestroy")],Da.prototype,"keepCacheOnDestroy",void 0),Object(l["a"])([Object(r["a"])("viewModel.respectLayerVisibility")],Da.prototype,"respectLayerVisibility",void 0),Object(l["a"])([Object(s["b"])()],Da.prototype,"iconClass",void 0),Object(l["a"])([Object(s["b"])({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Da.prototype,"label",void 0),Object(l["a"])([Object(r["a"])("viewModel.layerInfos")],Da.prototype,"layerInfos",void 0),Object(l["a"])([Object(s["b"])(),Object(h["a"])("esri/widgets/Legend/t9n/Legend")],Da.prototype,"messages",void 0),Object(l["a"])([Object(s["b"])()],Da.prototype,"style",void 0),Object(l["a"])([Object(n["a"])("style")],Da.prototype,"castStyle",null),Object(l["a"])([Object(r["a"])("viewModel.view")],Da.prototype,"view",void 0),Object(l["a"])([Object(s["b"])()],Da.prototype,"viewModel",void 0),Da=Object(l["a"])([Object(o["a"])("esri.widgets.Legend")],Da);var Pa=Da;t["default"]=Pa}}]);